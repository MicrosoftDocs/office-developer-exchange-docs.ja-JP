---
title: Exchange で EWS と REST のクライアントの要求をインストルメント化する
manager: sethgros
ms.date: 4/13/2016
ms.audience: Developer
localization_priority: Normal
ms.assetid: 330de503-498d-447e-b4a9-c20fc1699fd1
description: Exchange アプリケーションのモニターとトラブルシューティングに役立つ EWS と REST の要求と応答の HTTP ヘッダーについて説明します。
ms.openlocfilehash: bcf362952c29956729c44397043a56bf3603d0af
ms.sourcegitcommit: 34041125dc8c5f993b21cebfc4f8b72f0fd2cb6f
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 06/25/2018
ms.locfileid: "19759084"
---
# <a name="instrumenting-client-requests-for-ews-and-rest-in-exchange"></a><span data-ttu-id="77e04-103">Exchange で EWS と REST のクライアントの要求をインストルメント化する</span><span class="sxs-lookup"><span data-stu-id="77e04-103">Instrumenting client requests for EWS and REST in Exchange</span></span>

<span data-ttu-id="77e04-104">Exchange アプリケーションのモニターとトラブルシューティングに役立つ EWS と REST の要求と応答の HTTP ヘッダーについて説明します。</span><span class="sxs-lookup"><span data-stu-id="77e04-104">Learn about the HTTP headers in EWS and REST requests and responses that can help you monitor and troubleshoot your Exchange application.</span></span>
  
<span data-ttu-id="77e04-105">これまで起こったするでしょうか。</span><span class="sxs-lookup"><span data-stu-id="77e04-105">Has this ever happened to you?</span></span> <span data-ttu-id="77e04-106">アプリケーションのユーザーは、予期しないエラーを報告します。</span><span class="sxs-lookup"><span data-stu-id="77e04-106">A user of your application reports an unexpected error.</span></span> <span data-ttu-id="77e04-107">調査をするが、それを再現することはできません。</span><span class="sxs-lookup"><span data-stu-id="77e04-107">You want to investigate, but you can't reproduce it.</span></span> <span data-ttu-id="77e04-108">エラーがユーザーに表示されなくなったし、して残っているはほとんどの実用的なデータです。</span><span class="sxs-lookup"><span data-stu-id="77e04-108">The error has disappeared for the user, and you're left with very little actionable data.</span></span> <span data-ttu-id="77e04-109">フラストレーション、だと思いませんか。</span><span class="sxs-lookup"><span data-stu-id="77e04-109">Frustrating, isn't it?</span></span> <span data-ttu-id="77e04-110">このシナリオで事前に準備し、うまくいけば不満、将来的にしないようにする方法を見てみましょう。</span><span class="sxs-lookup"><span data-stu-id="77e04-110">Let's look at how you can proactively prepare for this scenario and hopefully avoid frustration in the future.</span></span>
  
## <a name="add-instrumentation-to-requests"></a><span data-ttu-id="77e04-111">要求にインストルメンテーションを追加する</span><span class="sxs-lookup"><span data-stu-id="77e04-111">Add instrumentation to requests</span></span>

<span data-ttu-id="77e04-p102">トラブルシューティングを容易にするために、要求に HTTP ヘッダーを追加することをお勧めします。後で必要になったら取得できるように、この情報をどこかに (ログ ファイルなど) 記録しておいてください。これは、ネットワーク トラフィックを調べるときに役立ちますが、Microsoft サポートに連絡して支援を求めるときにも役立ちます。</span><span class="sxs-lookup"><span data-stu-id="77e04-p102">We recommend that you add additional HTTP headers to your requests to facilitate troubleshooting. You should keep a record of this information somewhere (for example, in a log file) so that you can retrieve it later if you need to. This is helpful when examining network traffic, and is also helpful if you contact Microsoft support for assistance.</span></span>
  
<span data-ttu-id="77e04-115">**表 1 です。トラブルシューティングのための要求ヘッダー**</span><span class="sxs-lookup"><span data-stu-id="77e04-115">**Table 1. Request headers for troubleshooting**</span></span>

|<span data-ttu-id="77e04-116">**HTTP ヘッダー (EWS)**</span><span class="sxs-lookup"><span data-stu-id="77e04-116">**HTTP header (EWS)**</span></span>|<span data-ttu-id="77e04-117">**EWS のマネージ API と同じ**</span><span class="sxs-lookup"><span data-stu-id="77e04-117">**EWS Managed API equivalent**</span></span>|<span data-ttu-id="77e04-118">**メモ**</span><span class="sxs-lookup"><span data-stu-id="77e04-118">**Notes**</span></span>|
|:-----|:-----|:-----|
|<span data-ttu-id="77e04-119">User-Agent</span><span class="sxs-lookup"><span data-stu-id="77e04-119">User-Agent</span></span>  <br/> |[<span data-ttu-id="77e04-120">ExchangeService.UserAgent</span><span class="sxs-lookup"><span data-stu-id="77e04-120">ExchangeService.UserAgent</span></span>](http://msdn.microsoft.com/en-us/library/microsoft.exchange.webservices.data.exchangeservicebase.useragent%28v=exchg.80%29.aspx) <br/> |<span data-ttu-id="77e04-121">クライアント アプリケーションを識別する一意の値を設定します。</span><span class="sxs-lookup"><span data-stu-id="77e04-121">Set this to a unique value that identifies your client application.</span></span><br/><br/> <span data-ttu-id="77e04-122">呼び出しの失敗のトラブルシューティングに役立つ、マイクロソフトでは、アプリケーションが送信するすべての要求に対して同じ値を使用して、必要がある問題が発生します。</span><span class="sxs-lookup"><span data-stu-id="77e04-122">Using the same value for all requests that your application sends allows Microsoft to help troubleshoot call failures, should they arise.</span></span>  <br/> |
|<span data-ttu-id="77e04-123">client-request-id</span><span class="sxs-lookup"><span data-stu-id="77e04-123">client-request-id</span></span>  <br/> |[<span data-ttu-id="77e04-124">ExchangeService.ClientRequestId</span><span class="sxs-lookup"><span data-stu-id="77e04-124">ExchangeService.ClientRequestId</span></span>](http://msdn.microsoft.com/en-us/library/microsoft.exchange.webservices.data.exchangeservicebase.clientrequestid%28v=exchg.80%29.aspx) <br/> |<span data-ttu-id="77e04-125">これをアプリケーションに送信する要求ごとに異なる固有の値に設定します。</span><span class="sxs-lookup"><span data-stu-id="77e04-125">Set this to a different unique value for every request your application sends.</span></span><br/><br/> <span data-ttu-id="77e04-126">GUID を使用することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="77e04-126">We recommend that you use a GUID.</span></span> <span data-ttu-id="77e04-127">この一意の識別子は、問題が生じたことは、2 つのシステム間での活動を関連付けるために使用します。</span><span class="sxs-lookup"><span data-stu-id="77e04-127">This unique identifier is intended to be used to correlate activities between two systems in the event that something goes wrong.</span></span>  <br/> |
|<span data-ttu-id="77e04-128">return-client-request-id</span><span class="sxs-lookup"><span data-stu-id="77e04-128">return-client-request-id</span></span>  <br/> |[<span data-ttu-id="77e04-129">ExchangeService.ReturnClientRequestId</span><span class="sxs-lookup"><span data-stu-id="77e04-129">ExchangeService.ReturnClientRequestId</span></span>](http://msdn.microsoft.com/en-us/library/microsoft.exchange.webservices.data.exchangeservicebase.returnclientrequestid%28v=exchg.80%29.aspx) <br/> |<span data-ttu-id="77e04-130">設定を**true**に対応する応答にクライアントの要求の id の値を返す必要があることを Exchange サーバーに通知します。</span><span class="sxs-lookup"><span data-stu-id="77e04-130">Set this to **true** to signal to the Exchange server that it should return the value of your client-request-id in the corresponding response.</span></span><br/><br/> <span data-ttu-id="77e04-131">ネットワーク トレースまたは EWS マネージ API トレースにおける要求と応答を関連付けるためには、これを使用します。</span><span class="sxs-lookup"><span data-stu-id="77e04-131">You can use this to correlate requests and responses in network traces or EWS Managed API traces.</span></span>  <br/> |
|<span data-ttu-id="77e04-132">X-ClientStatistics</span><span class="sxs-lookup"><span data-stu-id="77e04-132">X-ClientStatistics</span></span>  <br/> |[<span data-ttu-id="77e04-133">ExchangeService.SendClientLatencies</span><span class="sxs-lookup"><span data-stu-id="77e04-133">ExchangeService.SendClientLatencies</span></span>](http://msdn.microsoft.com/en-us/library/microsoft.exchange.webservices.data.exchangeservicebase.sendclientlatencies%28v=exchg.80%29.aspx) <br/> |<span data-ttu-id="77e04-134">アプリケーションが Office 365 の一部として Exchange Online または Exchange Online をアクセスする場合は、マイクロソフトに[レポートの EWS の待ち時間](#bk_ReportLatency)を使用します。</span><span class="sxs-lookup"><span data-stu-id="77e04-134">Used to [report EWS latencies](#bk_ReportLatency) to Microsoft if your application is accessing Exchange Online or Exchange Online as part of Office 365.</span></span>  <br/> |
   
## <a name="log-information-from-responses"></a><span data-ttu-id="77e04-135">応答からのログ情報</span><span class="sxs-lookup"><span data-stu-id="77e04-135">Log information from responses</span></span>

<span data-ttu-id="77e04-p104">クライアントが送信する要求にインストルメンテーションを追加できるのと同様、Exchange も HTTP ヘッダーの形式でインストルメンテーションを応答に追加します。クライアントはこの情報を要求のインストルメンテーションの情報とともにキャプチャする必要があります。</span><span class="sxs-lookup"><span data-stu-id="77e04-p104">Just as your client can add additional instrumentation to the requests it sends, Exchange adds additional instrumentation to the responses in the form of HTTP headers. Your client should capture this information to go along with the request instrumentation information.</span></span>
  
> [!NOTE]
> <span data-ttu-id="77e04-138">EWS のマネージ API を使用する場合、HTTP ヘッダーに直接相当するものはありません。</span><span class="sxs-lookup"><span data-stu-id="77e04-138">If you are using the EWS Managed API, there is no direct equivalent for the HTTP headers.</span></span> <span data-ttu-id="77e04-139">ただし、すべての HTTP 応答ヘッダーは、 [ExchangeService.HttpResponseHeaders](http://msdn.microsoft.com/en-us/library/microsoft.exchange.webservices.data.exchangeservicebase.httpresponseheaders%28v=exchg.80%29.aspx)プロパティを通じてアクセスできます。</span><span class="sxs-lookup"><span data-stu-id="77e04-139">However, all HTTP response headers can be accessed via the [ExchangeService.HttpResponseHeaders](http://msdn.microsoft.com/en-us/library/microsoft.exchange.webservices.data.exchangeservicebase.httpresponseheaders%28v=exchg.80%29.aspx) property.</span></span> 
  
<span data-ttu-id="77e04-140">**表 2 になります。HTTP 応答ヘッダー**</span><span class="sxs-lookup"><span data-stu-id="77e04-140">**Table 2. HTTP response headers**</span></span>

|<span data-ttu-id="77e04-141">**HTTP ヘッダー**</span><span class="sxs-lookup"><span data-stu-id="77e04-141">**HTTP header**</span></span>|<span data-ttu-id="77e04-142">**説明**</span><span class="sxs-lookup"><span data-stu-id="77e04-142">**Description**</span></span>|
|:-----|:-----|
|<span data-ttu-id="77e04-143">request-id</span><span class="sxs-lookup"><span data-stu-id="77e04-143">request-id</span></span>  <br/> |<span data-ttu-id="77e04-144">この応答に対応する要求を表す、サーバーによって生成される ID。</span><span class="sxs-lookup"><span data-stu-id="77e04-144">A server-generated ID for the request that corresponds to this response.</span></span>  <br/> |
|<span data-ttu-id="77e04-145">client-request-id</span><span class="sxs-lookup"><span data-stu-id="77e04-145">client-request-id</span></span>  <br/> |<span data-ttu-id="77e04-146">要求でクライアントの要求の id のヘッダーの値。</span><span class="sxs-lookup"><span data-stu-id="77e04-146">The value of the client-request-id header in the request.</span></span><br/><br/> <span data-ttu-id="77e04-147">このヘッダーは、要求には、 **true**の値を返すクライアント要求 id ヘッダーが含まれている場合のみです。</span><span class="sxs-lookup"><span data-stu-id="77e04-147">This header is only present if the request contains the return-client-request-id header with a value of **true**.</span></span>  <br/> |
|<span data-ttu-id="77e04-148">X-FEServer</span><span class="sxs-lookup"><span data-stu-id="77e04-148">X-FEServer</span></span>  <br/> |<span data-ttu-id="77e04-149">要求を処理したクライアント アクセス サーバーの FQDN。</span><span class="sxs-lookup"><span data-stu-id="77e04-149">The FQDN of the Client Access server that processed the request.</span></span>  <br/> |
|<span data-ttu-id="77e04-150">X-TargetBEServer</span><span class="sxs-lookup"><span data-stu-id="77e04-150">X-TargetBEServer</span></span>  <br/> |<span data-ttu-id="77e04-151">要求を処理したメールボックス サーバーの FQDN。</span><span class="sxs-lookup"><span data-stu-id="77e04-151">The FQDN of the mailbox server that processed the request.</span></span>  <br/> |
|<span data-ttu-id="77e04-152">X-DiagInfo</span><span class="sxs-lookup"><span data-stu-id="77e04-152">X-DiagInfo</span></span>  <br/> |<span data-ttu-id="77e04-153">要求に応じた追加の診断情報。</span><span class="sxs-lookup"><span data-stu-id="77e04-153">Additional diagnostic information, depending on the request.</span></span>  <br/> |
|<span data-ttu-id="77e04-154">x-ms-diagnostics</span><span class="sxs-lookup"><span data-stu-id="77e04-154">x-ms-diagnostics</span></span>  <br/> | <span data-ttu-id="77e04-155">このヘッダーは、OAuth 認証が要求に使用します。</span><span class="sxs-lookup"><span data-stu-id="77e04-155">This header is only applicable if OAuth authentication is used in the request.</span></span><br/><br/> <span data-ttu-id="77e04-156">OAuth 認証が失敗した理由を指定する明示的なエラー コードが含まれています。</span><span class="sxs-lookup"><span data-stu-id="77e04-156">It contains an explicit error code that specifies why an OAuth authentication failed.</span></span><br/><br/> <span data-ttu-id="77e04-157">次の形式がかかります。`errorId;reason="reason"error_type="error type"`</span><span class="sxs-lookup"><span data-stu-id="77e04-157">It takes the following format: `errorId;reason="reason"error_type="error type"`</span></span><br/><br/> <span data-ttu-id="77e04-158">**[理由**] フィールドは、人間が判読できる、エラーの説明です。</span><span class="sxs-lookup"><span data-stu-id="77e04-158">The **reason** field is a human-readable description of the error.</span></span><br/><br/> <span data-ttu-id="77e04-159">**ErrorId**フィールドは、整数、および、**エラー\_型**フィールドは、整数の文字列形式を次のように。</span><span class="sxs-lookup"><span data-stu-id="77e04-159">The **errorId** field is an integer, and the **error\_type** field is the string representation of that integer, as follows:</span></span><ul><li><span data-ttu-id="77e04-160">2000000: 無効な\_署名</span><span class="sxs-lookup"><span data-stu-id="77e04-160">2000000: invalid\_signature</span></span></li><li><span data-ttu-id="77e04-161">2000001: 無効な\_トークン</span><span class="sxs-lookup"><span data-stu-id="77e04-161">2000001: invalid\_token</span></span></li><li>  <span data-ttu-id="77e04-162">2000002: トークン\_有効期限が切れて</span><span class="sxs-lookup"><span data-stu-id="77e04-162">2000002: token\_expired</span></span></li><li><span data-ttu-id="77e04-163">2000003: 無効な\_リソース</span><span class="sxs-lookup"><span data-stu-id="77e04-163">2000003: invalid\_resource</span></span></li><li><span data-ttu-id="77e04-164">2000004: 無効な\_テナント</span><span class="sxs-lookup"><span data-stu-id="77e04-164">2000004: invalid\_tenant</span></span>  </li><li><span data-ttu-id="77e04-165">2000005: 無効な\_ユーザー</span><span class="sxs-lookup"><span data-stu-id="77e04-165">2000005: invalid\_user</span></span></li><li><span data-ttu-id="77e04-166">2000006: 無効な\_クライアント</span><span class="sxs-lookup"><span data-stu-id="77e04-166">2000006: invalid\_client</span></span></li><li><span data-ttu-id="77e04-167">2000007: 内部\_エラー</span><span class="sxs-lookup"><span data-stu-id="77e04-167">2000007: internal\_error</span></span></li><li><span data-ttu-id="77e04-168">2000008: 無効な\_を与える</span><span class="sxs-lookup"><span data-stu-id="77e04-168">2000008: invalid\_grant</span></span></li></ul> |
   
## <a name="report-ews-latency-to-microsoft"></a><span data-ttu-id="77e04-169">Microsoft への EWS の待機時間の報告</span><span class="sxs-lookup"><span data-stu-id="77e04-169">Report EWS latency to Microsoft</span></span>
<span data-ttu-id="77e04-170"><a name="bk_ReportLatency"> </a></span><span class="sxs-lookup"><span data-stu-id="77e04-170"></span></span>

<span data-ttu-id="77e04-171">アプリケーションは、Exchange Online に接続するのには、EWS のマネージ API または EWS を使用する場合は、マイクロソフトに直接 EWS 要求の待機時間を報告できます。</span><span class="sxs-lookup"><span data-stu-id="77e04-171">If your application uses the EWS Managed API or EWS to connect to Exchange Online, you can report latency in EWS requests directly to Microsoft.</span></span> <span data-ttu-id="77e04-172">X ClientStatistics 要求ヘッダーを使用して、情報が渡されます。</span><span class="sxs-lookup"><span data-stu-id="77e04-172">The information is passed via the X-ClientStatistics request header.</span></span> <span data-ttu-id="77e04-173">EWS のマネージ API を使用する場合は、 [ExchangeService.SendClientLatencies](http://msdn.microsoft.com/en-us/library/microsoft.exchange.webservices.data.exchangeservicebase.sendclientlatencies%28v=exchg.80%29.aspx)プロパティを**true**に設定を実行する必要があるすべてが。</span><span class="sxs-lookup"><span data-stu-id="77e04-173">If you are using the EWS Managed API, all you have to do is set the [ExchangeService.SendClientLatencies](http://msdn.microsoft.com/en-us/library/microsoft.exchange.webservices.data.exchangeservicebase.sendclientlatencies%28v=exchg.80%29.aspx) property to **true**.</span></span> <span data-ttu-id="77e04-174">EWS を使用する場合は、要求を発行し、応答を受け取るまでの時間を測定し、次の EWS 要求を次の形式を使用して、アプリケーションを送信する X ClientStatistics ヘッダーを追加する必要があります。</span><span class="sxs-lookup"><span data-stu-id="77e04-174">If you are using EWS, you'll need to measure the time between issuing a request and receiving a response, then add the X-ClientStatistics header to the next EWS request your application sends, using the following format.</span></span>
  
`X-ClientStatistics: MessageId=<value of request-id header>,ResponseTime=<time in milliseconds>,SoapAction=<EWS operation>`
  
<span data-ttu-id="77e04-175">Microsoft はこれらの待機時間の報告を保存し、Exchange Online の EWS のサービスを継続的に改善するために使用します。</span><span class="sxs-lookup"><span data-stu-id="77e04-175">We maintain reports for these latencies and use them to continuously improve EWS services in Exchange Online.</span></span>
  
## <a name="next-steps"></a><span data-ttu-id="77e04-176">次の手順</span><span class="sxs-lookup"><span data-stu-id="77e04-176">Next steps</span></span>
<span data-ttu-id="77e04-177"><a name="bk_ReportLatency"> </a></span><span class="sxs-lookup"><span data-stu-id="77e04-177"></span></span>

<span data-ttu-id="77e04-178">クライアントの実装をアプリケーションに追加した後より準備ができました問題が生じた場合。</span><span class="sxs-lookup"><span data-stu-id="77e04-178">After you've added client instrumentation to your application, you're better prepared if something goes wrong.</span></span> <span data-ttu-id="77e04-179">そのような場合は、インストルメンテーション データを[アプリケーションのトラブルシューティング](tools-and-resources-for-troubleshooting-ews-applications-for-exchange.md)を使用できます。</span><span class="sxs-lookup"><span data-stu-id="77e04-179">If that happens, you can use your instrumentation data to [troubleshoot your application](tools-and-resources-for-troubleshooting-ews-applications-for-exchange.md).</span></span>
  
## <a name="see-also"></a><span data-ttu-id="77e04-180">関連項目</span><span class="sxs-lookup"><span data-stu-id="77e04-180">See also</span></span>

- [<span data-ttu-id="77e04-181">Exchange の EWS クライアントの設計の概要</span><span class="sxs-lookup"><span data-stu-id="77e04-181">EWS client design overview for Exchange</span></span>](ews-client-design-overview-for-exchange.md)
- [<span data-ttu-id="77e04-182">EWS のマネージ API アプリケーションのトラブルシューティングを行うには、要求と応答をトレースします。</span><span class="sxs-lookup"><span data-stu-id="77e04-182">Trace requests and responses to troubleshoot EWS Managed API applications</span></span>](how-to-trace-requests-responses-to-troubleshoot-ews-managed-api-applications.md)
- [<span data-ttu-id="77e04-183">Exchange の EWS アプリケーションのトラブルシューティングに使用するツールとリソース</span><span class="sxs-lookup"><span data-stu-id="77e04-183">Tools and resources for troubleshooting EWS applications for Exchange</span></span>](tools-and-resources-for-troubleshooting-ews-applications-for-exchange.md)
    

