---
title: Exchange 2013 のデータベースを復元する
manager: sethgros
ms.date: 09/17/2015
ms.audience: Developer
ms.topic: overview
ms.prod: office-online-server
localization_priority: Normal
ms.assetid: e0804bb1-fd66-448a-b2cb-9ae2726ae888
description: 2013 の Exchange データベースを復元することができますさまざまな方法に関する情報を検索します。
ms.openlocfilehash: d3ca3a884b0ad30f7d7968a9ed435b02aaf205e1
ms.sourcegitcommit: 34041125dc8c5f993b21cebfc4f8b72f0fd2cb6f
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 06/25/2018
ms.locfileid: "19758891"
---
# <a name="restoring-exchange-2013-databases"></a><span data-ttu-id="f85dd-103">Exchange 2013 のデータベースを復元する</span><span class="sxs-lookup"><span data-stu-id="f85dd-103">Restoring Exchange 2013 databases</span></span>

<span data-ttu-id="f85dd-104">2013 の Exchange データベースを復元することができますさまざまな方法に関する情報を検索します。</span><span class="sxs-lookup"><span data-stu-id="f85dd-104">Find information about the different ways that you can restore your Exchange 2013 databases.</span></span> 
  
<span data-ttu-id="f85dd-105">**に適用されます:** Exchange Server 2013</span><span class="sxs-lookup"><span data-stu-id="f85dd-105">**Applies to:** Exchange Server 2013</span></span> 
  
<span data-ttu-id="f85dd-106">含まれているでは、Exchange Server 2013 は、Exchange データベースを復元する方法のいくつかの柔軟性によって、Exchange ライター。</span><span class="sxs-lookup"><span data-stu-id="f85dd-106">The Exchange writer that is included in Exchange Server 2013 allows for some flexibility in how you restore your Exchange databases.</span></span> <span data-ttu-id="f85dd-107">Exchange 書き込みプログラムを使用して、Exchange 2013 で、次の場所に、シャドウ コピー バックアップを復元できます。</span><span class="sxs-lookup"><span data-stu-id="f85dd-107">By using the Exchange writer in Exchange 2013, you can restore your shadow copy backups to the following locations:</span></span>
  
- <span data-ttu-id="f85dd-108">元のデータベース。データベースやトランザクション ログ ファイルのパス構成が変更されているかどうかは関係ありません。</span><span class="sxs-lookup"><span data-stu-id="f85dd-108">The original database, regardless of whether the database or transaction log file path configuration has been modified.</span></span>
    
- <span data-ttu-id="f85dd-109">回復用データベース。</span><span class="sxs-lookup"><span data-stu-id="f85dd-109">A recovery database.</span></span>
    
- <span data-ttu-id="f85dd-110">実稼働データベース。データベースの表示名が VSS バックアップ セットの名前と一致しているかどうかは関係ありません。</span><span class="sxs-lookup"><span data-stu-id="f85dd-110">Any production database, regardless of whether the database display name matches the name in a VSS backup set.</span></span>
    
<span data-ttu-id="f85dd-111">復元アプリケーションでは、元のデータベースに情報を復元、ときに、そのデータベースの Active Directory ドメイン サービス (AD DS) で指定されたディレクトリのパスにログ ファイルを復元しなければなりません。</span><span class="sxs-lookup"><span data-stu-id="f85dd-111">When your restore application restores information to the original database, the log files must be restored to the directory path specified in Active Directory Domain Services (AD DS) for that database.</span></span> <span data-ttu-id="f85dd-112">場合は、アプリケーションでは、別の場所にデータベースを復元、データベースのログ ファイルのディレクトリ内にある **_restoredLogs**をという名前のフォルダーにログ ファイルを復元しなければなりません。</span><span class="sxs-lookup"><span data-stu-id="f85dd-112">If your application restores a database to a different location, the log files must be restored to a folder named **_restoredLogs** that is located inside the database log file directory.</span></span> 
  
<span data-ttu-id="f85dd-113">サーバーまたは元のデータベースとは異なるデータベースを復元して、復元アプリケーションは必ず VSS に用意されているデータベース ・ ディレクトリ ・ パスと一致している AD DS の。</span><span class="sxs-lookup"><span data-stu-id="f85dd-113">When restoring to a server or database that is different than the original database, your restore application must make sure that the database directory paths provided to VSS match those in AD DS.</span></span> <span data-ttu-id="f85dd-114">[Get MailboxDatabase](http://technet.microsoft.com/en-us/library/bb124924%28v=exchg.150%29.aspx)Exchange 管理シェル コマンドレットを使用すると、既存のデータベースに関する情報を取得します。</span><span class="sxs-lookup"><span data-stu-id="f85dd-114">You can use the [get-MailboxDatabase](http://technet.microsoft.com/en-us/library/bb124924%28v=exchg.150%29.aspx)Exchange Management Shell cmdlet to get information about existing databases.</span></span> <span data-ttu-id="f85dd-115">Exchange 管理シェルの詳細については、 [Exchange Server PowerShell (Exchange 管理シェル)](https://docs.microsoft.com/en-us/powershell/exchange/exchange-server/exchange-management-shell?view=exchange-ps)を参照してください。</span><span class="sxs-lookup"><span data-stu-id="f85dd-115">For more information about the Exchange Management Shell, see [Exchange Server PowerShell (Exchange Management Shell)](https://docs.microsoft.com/en-us/powershell/exchange/exchange-server/exchange-management-shell?view=exchange-ps).</span></span> 
  
<span data-ttu-id="f85dd-116">次の図は、ボリューム シャドウ コピー サービス (VSS) で管理されている Exchange データベースの一般的な復元でのイベントのシーケンスを示しています。</span><span class="sxs-lookup"><span data-stu-id="f85dd-116">The following figure shows the sequence of events in a typical restore of an Exchange database that is managed by the Volume Shadow Copy Service (VSS).</span></span>
  
<span data-ttu-id="f85dd-117">**図 1 です。データベースを復元するためのイベントの順序**</span><span class="sxs-lookup"><span data-stu-id="f85dd-117">**Figure 1. Sequence of events for restoring databases**</span></span>

![復元プロセスのイベント シーケンスを示す図。シーケンスは、Exchange ストアの起動から始まり、Exchange ライター、VSS、およびクライアント アプリケーションの間での多くのステップが続きます。](media/VSS_StoreWriterRestore.gif)
  
## <a name="restoring-exchange-databases-to-the-original-location"></a><span data-ttu-id="f85dd-120">元の場所への Exchange データベースの復元</span><span class="sxs-lookup"><span data-stu-id="f85dd-120">Restoring Exchange databases to the original location</span></span>
<span data-ttu-id="f85dd-121"><a name="bk_OriginalLocation"> </a></span><span class="sxs-lookup"><span data-stu-id="f85dd-121"></span></span>

<span data-ttu-id="f85dd-122">Exchange 書き込みプログラムは、Exchange サーバー上の元の場所にデータベースとトランザクション ログ ファイルを復元するアプリケーションを有効にします。</span><span class="sxs-lookup"><span data-stu-id="f85dd-122">The Exchange writer enables applications to restore databases and transaction log files to their original locations on the Exchange server.</span></span> <span data-ttu-id="f85dd-123">既定では、Exchange ライターは、依頼者は、 [OnPostRestore](http://msdn.microsoft.com/en-us/library/windows/desktop/aa381566%28v=vs.85%29.aspx)操作中に復元が完了したことを確認した後にトランザクション ログ ファイルを再生します。</span><span class="sxs-lookup"><span data-stu-id="f85dd-123">By default, the Exchange writer replays the transaction log files after the requester confirms that the restore is complete during the [OnPostRestore](http://msdn.microsoft.com/en-us/library/windows/desktop/aa381566%28v=vs.85%29.aspx) operation.</span></span> <span data-ttu-id="f85dd-124">リストア ・ アプリケーションは、ログ ファイルを再生することを防ぐために、VSS の[SetAdditionalRestores](http://msdn.microsoft.com/en-us/library/windows/desktop/aa382829%28v=vs.85%29.aspx)メソッドを使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="f85dd-124">The restore application must use the VSS [SetAdditionalRestores](http://msdn.microsoft.com/en-us/library/windows/desktop/aa382829%28v=vs.85%29.aspx) method to prevent having the log files replayed.</span></span> <span data-ttu-id="f85dd-125">Exchange 管理者またはアプリケーションが復元されたデータベースを再マウントすると後でログ ファイルを再生することができます。</span><span class="sxs-lookup"><span data-stu-id="f85dd-125">The log files can be replayed at a later time when the Exchange administrator or your application remounts the restored database.</span></span> 
  
<span data-ttu-id="f85dd-126">(バックアップ セットのデータベース内のターゲットの Guid と一致) するようにオブジェクトの元のデータベースにデータベースを復元するが、別のファイルのパスにアプリケーションし必要があります現在のファイル パスを決定するバックアップ ファイルを復元します対応するファイルのパスがデータベースのプロパティで指定します。</span><span class="sxs-lookup"><span data-stu-id="f85dd-126">When restoring databases back to their original database objects (such that the target GUIDs in the database match those in the backup set) but to different file paths, the application must determine the current file paths and restore the backup files to the corresponding file paths specified in the database properties.</span></span> <span data-ttu-id="f85dd-127">依頼者は、Exchange ライターに、ファイルのリストア ・ プロセスの残りの部分とライターを続行するに復元する場所を通信するために[AddNewTarget](http://msdn.microsoft.com/en-us/library/windows/desktop/aa382648%28v=vs.85%29.aspx)メソッドを呼び出す必要があります。</span><span class="sxs-lookup"><span data-stu-id="f85dd-127">The requester must call the [AddNewTarget](http://msdn.microsoft.com/en-us/library/windows/desktop/aa382648%28v=vs.85%29.aspx) method to communicate to the Exchange writer the location where the files are restored before the writer can continue with the rest of the restore process.</span></span> <span data-ttu-id="f85dd-128">**AddNewTarget**が呼び出されない場合、Exchange 書き込みプログラムはバックアップ メタデータ ドキュメントで指定されたファイルのパスをバックアップを復元することと仮定します。</span><span class="sxs-lookup"><span data-stu-id="f85dd-128">If **AddNewTarget** is not called, the Exchange writer assumes that the backups are restored to the file paths specified in the backup metadata document.</span></span> 
  
<span data-ttu-id="f85dd-p107">通常、カスタムのアプリケーションでは、データベース可用性グループ (DAG) のコピーから実行するバックアップに新しいパスを指定する必要はありません。Exchange 管理者は、通常はデータベースやログ ファイルのパスを変更しません。ただし、DAG 構成では、アクティブなデータベースとログのパスをバックアップ アプリケーションで指定することが必要になることがあります (それらのパスと DAG コピーのパスは常に異なるため)。</span><span class="sxs-lookup"><span data-stu-id="f85dd-p107">Typically, your application does not have to specify a new path for backups that are performed from a Database Availability Group (DAG) copy. Exchange administrators do not usually change database or log file paths. In a DAG configuration, however, the backup application might have to specify the active database and log paths, because DAG copy paths are always different from those paths.</span></span>
  
<span data-ttu-id="f85dd-132">非アクティブな DAG のデータベースのコピーを復元するをサポートしていない Exchange 2013 ことに注意してください。</span><span class="sxs-lookup"><span data-stu-id="f85dd-132">Note that Exchange 2013 does not support restoring inactive DAG database copies.</span></span> <span data-ttu-id="f85dd-133">DAG のコピーは、アクティブなデータベースのコピーが復元されたときにのみバックアップ データから復元できます。</span><span class="sxs-lookup"><span data-stu-id="f85dd-133">DAG copies can be restored from backup data only when the active database copy is restored.</span></span> <span data-ttu-id="f85dd-134">別のバックアップ データ セットを使用するか、データベースのコピーの一部を復元しようとしています。 データベースをマウントが発生することができます。</span><span class="sxs-lookup"><span data-stu-id="f85dd-134">Using different backup data sets or attempting to restore a subset of the database copies can cause the database to become unmountable.</span></span> <span data-ttu-id="f85dd-135">作成された元のデータベース オブジェクトを復元するためのバックアップ ・ アプリケーションではこの例では、 [SetRestoreOptions](http://msdn.microsoft.com/en-us/library/windows/desktop/aa382856%28v=vs.85%29.aspx)関数を呼び出す必要はありません。</span><span class="sxs-lookup"><span data-stu-id="f85dd-135">Backup applications do not have to call the [SetRestoreOptions](http://msdn.microsoft.com/en-us/library/windows/desktop/aa382856%28v=vs.85%29.aspx) function in this case, because the backups are restored to the original database objects they were created from.</span></span> <span data-ttu-id="f85dd-136">ただし、バックアップ ・ アプリケーションは、 **SetRestoreOptions**を呼び出して、XML メタデータ ドキュメントは、適切なパラメーターを持つ場合は、エラーが発生しない、します。</span><span class="sxs-lookup"><span data-stu-id="f85dd-136">However, if the backup application calls **SetRestoreOptions** and the XML metadata document has the correct parameters, the result is not an error.</span></span> 
  
## <a name="restoring-exchange-databases-to-a-recovery-database"></a><span data-ttu-id="f85dd-137">Exchange データベースの回復用データベースへの復元</span><span class="sxs-lookup"><span data-stu-id="f85dd-137">Restoring Exchange databases to a recovery database</span></span>
<span data-ttu-id="f85dd-138"><a name="bk_RecoveryDatabase"> </a></span><span class="sxs-lookup"><span data-stu-id="f85dd-138"></span></span>

<span data-ttu-id="f85dd-p109">Exchange ライターを使用すると、回復用のデータベースに直接データを復元できるようになります。回復したデータを回復用データベースとしてマウントすると、Exchange 管理者は個々のメールボックス (メールボックス内の個々のアイテムも) 復元できます。</span><span class="sxs-lookup"><span data-stu-id="f85dd-p109">The Exchange writer enables you to restore data directly to a recovery database. Mounting the recovered data as a recovery database allows the Exchange administrator to restore individual mailboxes, and even individual items in a mailbox.</span></span>
  
<span data-ttu-id="f85dd-141">回復用データベースが既に存在する場合、アプリケーションでデータベースのマウントを解除し、データを回復用データベースとログ ファイルに復元して、データベースを再度マウントできます。</span><span class="sxs-lookup"><span data-stu-id="f85dd-141">If a recovery database already exists, your application can dismount the database, restore the data onto the recovery database and log files, and then remount the database.</span></span>
  
<span data-ttu-id="f85dd-142">各 Exchange 2013 サーバーでは、1 つだけの回復用データベースを同時にマウントします。</span><span class="sxs-lookup"><span data-stu-id="f85dd-142">Each Exchange 2013 server allows for only one recovery database to be mounted at a time.</span></span> <span data-ttu-id="f85dd-143">サーバーは、ディスクの空き領域が許可されているが、1 つだけは、回復用データベースとしてマウントできるよう多くのリカバリされたデータベースを含めることができます。</span><span class="sxs-lookup"><span data-stu-id="f85dd-143">The server can contain as many recovered databases as disk space allows, but only one can be mounted as the recovery database.</span></span> <span data-ttu-id="f85dd-144">回復用データベースとしてマウントされているデータベースは、一度にマウントできるデータベースの最大数にカウントされます。</span><span class="sxs-lookup"><span data-stu-id="f85dd-144">The database mounted as the recovery database is counted in the maximum number of databases that can be mounted at a time.</span></span> <span data-ttu-id="f85dd-145">サーバーの回復用データベースがどのような方法で元のメールボックスに関連付けられているではないために、復元されたデータベースがマウントされます。</span><span class="sxs-lookup"><span data-stu-id="f85dd-145">A recovered database mounted as a server's recovery database is not associated with the original mailbox in any way.</span></span>
  
<span data-ttu-id="f85dd-146">回復用データベースに復元するに、アプリケーション必要があります[SetRestoreOptions](http://msdn.microsoft.com/en-us/library/windows/desktop/aa382856%28v=vs.85%29.aspx)メソッドを呼び出すソースを示す XML ドキュメントを提供してデータベース Guid を対象とします。</span><span class="sxs-lookup"><span data-stu-id="f85dd-146">To recover to a recovery database, your application must call the [SetRestoreOptions](http://msdn.microsoft.com/en-us/library/windows/desktop/aa382856%28v=vs.85%29.aspx) method and provide an XML document that indicates the source and target database GUIDs.</span></span> <span data-ttu-id="f85dd-147">ソース Guid と一致しなければなりません、バックアップ ・ セットからとターゲット Guid が AD DS に転送先データベースのエントリと一致する必要があります。</span><span class="sxs-lookup"><span data-stu-id="f85dd-147">The source GUIDs must match those from the backup set, and the target GUIDs must match the destination database entries in AD DS.</span></span> <span data-ttu-id="f85dd-148">バックアップ ・ アプリケーションでは、ディレクトリのパスにファイルを復元する場所を指定する[AddNewTarget](http://msdn.microsoft.com/en-us/library/windows/desktop/aa382648%28v=vs.85%29.aspx)メソッドを呼び出す必要がありますもします。</span><span class="sxs-lookup"><span data-stu-id="f85dd-148">The backup application must also call the [AddNewTarget](http://msdn.microsoft.com/en-us/library/windows/desktop/aa382648%28v=vs.85%29.aspx) method to specify the directory path where the files are restored to.</span></span> <span data-ttu-id="f85dd-149">データベース ファイルの名前を変更する場合は、Exchange ライターは[OnPostRestore](http://msdn.microsoft.com/en-us/library/windows/desktop/aa381566%28v=vs.85%29.aspx)操作中にデータベースを変更します。</span><span class="sxs-lookup"><span data-stu-id="f85dd-149">If the database files need to be renamed, the Exchange writer will rename the database during the [OnPostRestore](http://msdn.microsoft.com/en-us/library/windows/desktop/aa381566%28v=vs.85%29.aspx) operation.</span></span> <span data-ttu-id="f85dd-150">Exchange では、現在のトランザクション ログ ファイルのパスの下にある ( **_restoredLogs**) のサブフォルダーに復元するトランザクション ログ ファイルが必要です。</span><span class="sxs-lookup"><span data-stu-id="f85dd-150">Exchange requires the transaction log files to be restored to a subfolder ( **_restoredLogs**) under the current transaction log file path.</span></span> <span data-ttu-id="f85dd-151">ログ ファイルは、他の任意の場所に復元は、Exchange 書き込みプログラムはエラーを返します。</span><span class="sxs-lookup"><span data-stu-id="f85dd-151">If the log files are restored to any other location, the Exchange writer will return an error.</span></span> <span data-ttu-id="f85dd-152">回復用データベースとしてマウントされているデータベースが元の場所に復元されないため、それらをマウントする前にクリーン シャット ダウン状態になる必要があります。</span><span class="sxs-lookup"><span data-stu-id="f85dd-152">Because databases being mounted as the recovery database are not restored to their original location, they need to be brought into clean-shutdown state before they can be mounted.</span></span> <span data-ttu-id="f85dd-153">既定では、Exchange 書き込みプログラムが表示されます復元されたすべてのデータベースをクリーン シャット ダウン状態に post-restore の中に。</span><span class="sxs-lookup"><span data-stu-id="f85dd-153">By default, the Exchange writer will bring all the restored databases into a clean-shutdown state during post-restore.</span></span> <span data-ttu-id="f85dd-154">バックアップ ・ アプリケーションは、 [SetAdditionalRestores](http://msdn.microsoft.com/en-us/library/windows/desktop/aa382829%28v=vs.85%29.aspx)メソッドを呼び出し、Exchange ライターは、ログ ファイルを再生、および、管理者またはバックアップ ・ アプリケーション、データベースをマウントする前にクリーン シャット ダウン状態に移動する必要があります場合、。データベースです。</span><span class="sxs-lookup"><span data-stu-id="f85dd-154">If your backup application calls the [SetAdditionalRestores](http://msdn.microsoft.com/en-us/library/windows/desktop/aa382829%28v=vs.85%29.aspx) method, the Exchange writer will not replay the log files, and either the administrator or your backup application needs to bring the database into a clean-shutdown state prior to mounting the database.</span></span> 
  
## <a name="restoring-exchange-databases-to-a-recovery-server"></a><span data-ttu-id="f85dd-155">Exchange データベースの回復用サーバーへの復元</span><span class="sxs-lookup"><span data-stu-id="f85dd-155">Restoring Exchange databases to a recovery server</span></span>
<span data-ttu-id="f85dd-156"><a name="bk_RecoveryServer"> </a></span><span class="sxs-lookup"><span data-stu-id="f85dd-156"></span></span>

<span data-ttu-id="f85dd-157">一部のシナリオでは別のサーバーにバックアップ セットを復元する必要があります。などに、同じ Exchange 組織内の別の Exchange 2013 サーバーにメールボックス データベースの移植で致命的なサーバー障害から回復するか、メールボックスを回復するのには本番環境の外部の専用のサーバーに復元する必要があり、パブリック フォルダーのデータです。</span><span class="sxs-lookup"><span data-stu-id="f85dd-157">In some scenarios, you might need to recover a backup set to another server; For example, you might need to recover from a catastrophic server failure by porting the mailbox database to another Exchange 2013 server in the same Exchange organization, or restore to a dedicated server outside the production environment to recover mailbox and public folder data.</span></span> 
  
<span data-ttu-id="f85dd-158">これらのシナリオでそのオブジェクトの Guid だけでなく、ターゲット データベースのファイル パスが元のデータベースのものとは異なる。</span><span class="sxs-lookup"><span data-stu-id="f85dd-158">In these scenarios, the file paths for the target database as well as its object GUIDs are different than those for the original database.</span></span> <span data-ttu-id="f85dd-159">したがって、アプリケーションがソースとターゲット データベースの情報を復元するバックアップ ファイルへのディレクトリ パスを指定するのには、 [AddNewTarget](http://msdn.microsoft.com/en-us/library/windows/desktop/aa382648%28v=vs.85%29.aspx)メソッドの呼び出しを示す XML ドキュメントで[SetRestoreOptions](http://msdn.microsoft.com/en-us/library/windows/desktop/aa382856%28v=vs.85%29.aspx)メソッドを呼び出し、します。.</span><span class="sxs-lookup"><span data-stu-id="f85dd-159">Therefore, your application has to call the [SetRestoreOptions](http://msdn.microsoft.com/en-us/library/windows/desktop/aa382856%28v=vs.85%29.aspx) method with an XML document that indicates the source and target database information, and call the [AddNewTarget](http://msdn.microsoft.com/en-us/library/windows/desktop/aa382648%28v=vs.85%29.aspx) method to specify the directory paths to restore the backup files to.</span></span> <span data-ttu-id="f85dd-160">Exchange ライターの場合、このリストアとは、回復用データベースを復元すると同じです。</span><span class="sxs-lookup"><span data-stu-id="f85dd-160">For the Exchange writer, this restore is the same as restoring to a recovery database.</span></span> <span data-ttu-id="f85dd-161">詳細については、この資料の以前のバージョン[を復元する Exchange データベースの回復用データベース](restoring-exchange-2013-databases.md#bk_RecoveryDatabase)を参照してください。</span><span class="sxs-lookup"><span data-stu-id="f85dd-161">For more information, see [Restoring Exchange databases to a recovery database](restoring-exchange-2013-databases.md#bk_RecoveryDatabase) earlier in this article.</span></span> 
  
## <a name="see-also"></a><span data-ttu-id="f85dd-162">関連項目</span><span class="sxs-lookup"><span data-stu-id="f85dd-162">See also</span></span>
<span data-ttu-id="f85dd-163"><a name="bk_AdditionalResources"> </a></span><span class="sxs-lookup"><span data-stu-id="f85dd-163"></span></span>

- [<span data-ttu-id="f85dd-164">Exchange 2013 のバックアップ操作の種類</span><span class="sxs-lookup"><span data-stu-id="f85dd-164">Types of backup operations for Exchange 2013</span></span>](types-of-backup-operations-for-exchange-2013.md)
    
- [<span data-ttu-id="f85dd-165">バックアップを作成し、Exchange 2013 のアプリケーションを復元します。</span><span class="sxs-lookup"><span data-stu-id="f85dd-165">Build backup and restore applications for Exchange 2013</span></span>](build-backup-and-restore-applications-for-exchange-2013.md)
    
- [<span data-ttu-id="f85dd-166">Exchange 2013 のバックアップと復元の概念</span><span class="sxs-lookup"><span data-stu-id="f85dd-166">Backup and restore concepts for Exchange 2013</span></span>](backup-and-restore-concepts-for-exchange-2013.md)
    
- [<span data-ttu-id="f85dd-167">CChkSGFiles クラスの参照</span><span class="sxs-lookup"><span data-stu-id="f85dd-167">CChkSGFiles class reference</span></span>](cchksgfiles-class-reference.md)
    

