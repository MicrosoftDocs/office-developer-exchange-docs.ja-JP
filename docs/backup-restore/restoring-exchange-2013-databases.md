---
title: Exchange 2013 のデータベースを復元する
manager: sethgros
ms.date: 09/17/2015
ms.audience: Developer
ms.topic: overview
ms.prod: office-online-server
localization_priority: Normal
ms.assetid: e0804bb1-fd66-448a-b2cb-9ae2726ae888
description: Exchange 2013 データベースを復元するさまざまな方法についての情報を参照してください。
ms.openlocfilehash: 9fe417bda5dc728af619da02d62ada6e920f731d
ms.sourcegitcommit: 88ec988f2bb67c1866d06b361615f3674a24e795
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 06/03/2020
ms.locfileid: "44528674"
---
# <a name="restoring-exchange-2013-databases"></a><span data-ttu-id="fb35a-103">Exchange 2013 のデータベースを復元する</span><span class="sxs-lookup"><span data-stu-id="fb35a-103">Restoring Exchange 2013 databases</span></span>

<span data-ttu-id="fb35a-104">Exchange 2013 データベースを復元するさまざまな方法についての情報を参照してください。</span><span class="sxs-lookup"><span data-stu-id="fb35a-104">Find information about the different ways that you can restore your Exchange 2013 databases.</span></span> 
  
<span data-ttu-id="fb35a-105">**製品:** Exchange Server 2013</span><span class="sxs-lookup"><span data-stu-id="fb35a-105">**Applies to:** Exchange Server 2013</span></span> 
  
<span data-ttu-id="fb35a-106">Exchange Server 2013 に含まれている Exchange ライターを使用すると、Exchange データベースを柔軟に復元できます。</span><span class="sxs-lookup"><span data-stu-id="fb35a-106">The Exchange writer that is included in Exchange Server 2013 allows for some flexibility in how you restore your Exchange databases.</span></span> <span data-ttu-id="fb35a-107">Exchange 2013 の Exchange ライターを使用すると、シャドウコピーバックアップを次の場所に復元できます。</span><span class="sxs-lookup"><span data-stu-id="fb35a-107">By using the Exchange writer in Exchange 2013, you can restore your shadow copy backups to the following locations:</span></span>
  
- <span data-ttu-id="fb35a-108">元のデータベース。データベースやトランザクション ログ ファイルのパス構成が変更されているかどうかは関係ありません。</span><span class="sxs-lookup"><span data-stu-id="fb35a-108">The original database, regardless of whether the database or transaction log file path configuration has been modified.</span></span>
    
- <span data-ttu-id="fb35a-109">回復用データベース。</span><span class="sxs-lookup"><span data-stu-id="fb35a-109">A recovery database.</span></span>
    
- <span data-ttu-id="fb35a-110">実稼働データベース。データベースの表示名が VSS バックアップ セットの名前と一致しているかどうかは関係ありません。</span><span class="sxs-lookup"><span data-stu-id="fb35a-110">Any production database, regardless of whether the database display name matches the name in a VSS backup set.</span></span>
    
<span data-ttu-id="fb35a-111">復元アプリケーションで元のデータベースに情報を復元する場合は、そのデータベースに対して Active Directory ドメイン サービス (AD DS) で指定されたディレクトリ パスにログ ファイルが復元されている必要があります。</span><span class="sxs-lookup"><span data-stu-id="fb35a-111">When your restore application restores information to the original database, the log files must be restored to the directory path specified in Active Directory Domain Services (AD DS) for that database.</span></span> <span data-ttu-id="fb35a-112">復元アプリケーションで別の場所にデータベースを復元する場合は、データベース ログ ファイルのディレクト内に配置された **_restoredLogs** という名前のフォルダーにログ ファイルが復元されている必要があります。</span><span class="sxs-lookup"><span data-stu-id="fb35a-112">If your application restores a database to a different location, the log files must be restored to a folder named **_restoredLogs** that is located inside the database log file directory.</span></span> 
  
<span data-ttu-id="fb35a-113">元のデータベースとは別のサーバーまたはデータベースに復元する場合は、VSS に指定されたデータベース ディレクトリのパスが AD DS のパスと一致していることを復元アプリケーションで確認する必要があります。</span><span class="sxs-lookup"><span data-stu-id="fb35a-113">When restoring to a server or database that is different than the original database, your restore application must make sure that the database directory paths provided to VSS match those in AD DS.</span></span> <span data-ttu-id="fb35a-114">[Set-mailboxdatabase](https://technet.microsoft.com/library/bb124924%28v=exchg.150%29.aspx)Exchange 管理シェルコマンドレットを使用して、既存のデータベースに関する情報を取得できます。</span><span class="sxs-lookup"><span data-stu-id="fb35a-114">You can use the [get-MailboxDatabase](https://technet.microsoft.com/library/bb124924%28v=exchg.150%29.aspx)Exchange Management Shell cmdlet to get information about existing databases.</span></span> <span data-ttu-id="fb35a-115">Exchange 管理シェルの詳細については、「 [Exchange Server PowerShell (Exchange Management shell)](https://docs.microsoft.com/powershell/exchange/exchange-server/exchange-management-shell?view=exchange-ps)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="fb35a-115">For more information about the Exchange Management Shell, see [Exchange Server PowerShell (Exchange Management Shell)](https://docs.microsoft.com/powershell/exchange/exchange-server/exchange-management-shell?view=exchange-ps).</span></span> 
  
<span data-ttu-id="fb35a-116">次の図は、ボリューム シャドウ コピー サービス (VSS) で管理されている Exchange データベースの一般的な復元でのイベントのシーケンスを示しています。</span><span class="sxs-lookup"><span data-stu-id="fb35a-116">The following figure shows the sequence of events in a typical restore of an Exchange database that is managed by the Volume Shadow Copy Service (VSS).</span></span>
  
<span data-ttu-id="fb35a-117">**図 1データベースを復元するためのイベントのシーケンス**</span><span class="sxs-lookup"><span data-stu-id="fb35a-117">**Figure 1. Sequence of events for restoring databases**</span></span>

![復元プロセスのイベント シーケンスを示す図。シーケンスは、Exchange ストアの起動から始まり、Exchange ライター、VSS、およびクライアント アプリケーションの間での多くのステップが続きます。](media/VSS_StoreWriterRestore.gif)
  
## <a name="restoring-exchange-databases-to-the-original-location"></a><span data-ttu-id="fb35a-120">元の場所への Exchange データベースの復元</span><span class="sxs-lookup"><span data-stu-id="fb35a-120">Restoring Exchange databases to the original location</span></span>
<span data-ttu-id="fb35a-121"><a name="bk_OriginalLocation"> </a></span><span class="sxs-lookup"><span data-stu-id="fb35a-121"><a name="bk_OriginalLocation"> </a></span></span>

<span data-ttu-id="fb35a-122">Exchange ライターにより、アプリケーションで Exchange サーバー上のデータベースとトランザクション ログ ファイルをそれぞれの元の場所に復元できます。</span><span class="sxs-lookup"><span data-stu-id="fb35a-122">The Exchange writer enables applications to restore databases and transaction log files to their original locations on the Exchange server.</span></span> <span data-ttu-id="fb35a-123">既定では、Exchange ライターは、要求者が[Onpostrestore](https://msdn.microsoft.com/library/windows/desktop/aa381566%28v=vs.85%29.aspx)操作中に復元が完了したことを確認した後、トランザクションログファイルを再生します。</span><span class="sxs-lookup"><span data-stu-id="fb35a-123">By default, the Exchange writer replays the transaction log files after the requester confirms that the restore is complete during the [OnPostRestore](https://msdn.microsoft.com/library/windows/desktop/aa381566%28v=vs.85%29.aspx) operation.</span></span> <span data-ttu-id="fb35a-124">復元アプリケーションでは、ログファイルが再生されないように VSS [Setadditionalrestores](https://msdn.microsoft.com/library/windows/desktop/aa382829%28v=vs.85%29.aspx)メソッドを使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="fb35a-124">The restore application must use the VSS [SetAdditionalRestores](https://msdn.microsoft.com/library/windows/desktop/aa382829%28v=vs.85%29.aspx) method to prevent having the log files replayed.</span></span> <span data-ttu-id="fb35a-125">このログ ファイルは、復元したデータベースを Exchange 管理者またはアプリケーションが再マウントするときに後から再生できます。</span><span class="sxs-lookup"><span data-stu-id="fb35a-125">The log files can be replayed at a later time when the Exchange administrator or your application remounts the restored database.</span></span> 
  
<span data-ttu-id="fb35a-126">データベースを元のデータベース オブジェクト (データベースのターゲット GUID とバックアップ セットの GUID が同じになるもの) に復元するときに、ファイル パスを別のものにする場合は、アプリケーションで現在のファイル パスを判断して、それに対応するデータベースのプロパティで指定されたファイル パスにバックアップ ファイルを復元する必要があります。</span><span class="sxs-lookup"><span data-stu-id="fb35a-126">When restoring databases back to their original database objects (such that the target GUIDs in the database match those in the backup set) but to different file paths, the application must determine the current file paths and restore the backup files to the corresponding file paths specified in the database properties.</span></span> <span data-ttu-id="fb35a-127">リクエスターは、ファイルの復元先として Exchange ライターと通信するために、 [Addnewtarget](https://msdn.microsoft.com/library/windows/desktop/aa382648%28v=vs.85%29.aspx)メソッドを呼び出して、残りの復元プロセスでライターを続行できるようにする必要があります。</span><span class="sxs-lookup"><span data-stu-id="fb35a-127">The requester must call the [AddNewTarget](https://msdn.microsoft.com/library/windows/desktop/aa382648%28v=vs.85%29.aspx) method to communicate to the Exchange writer the location where the files are restored before the writer can continue with the rest of the restore process.</span></span> <span data-ttu-id="fb35a-128">**AddNewTarget** が呼び出されていないと、Exchange ライターはバックアップがバックアップ メタデータ ドキュメントで指定されたファイル パスに復元されると想定します。</span><span class="sxs-lookup"><span data-stu-id="fb35a-128">If **AddNewTarget** is not called, the Exchange writer assumes that the backups are restored to the file paths specified in the backup metadata document.</span></span> 
  
<span data-ttu-id="fb35a-p107">通常、カスタムのアプリケーションでは、データベース可用性グループ (DAG) のコピーから実行するバックアップに新しいパスを指定する必要はありません。Exchange 管理者は、通常はデータベースやログ ファイルのパスを変更しません。ただし、DAG 構成では、アクティブなデータベースとログのパスをバックアップ アプリケーションで指定することが必要になることがあります (それらのパスと DAG コピーのパスは常に異なるため)。</span><span class="sxs-lookup"><span data-stu-id="fb35a-p107">Typically, your application does not have to specify a new path for backups that are performed from a Database Availability Group (DAG) copy. Exchange administrators do not usually change database or log file paths. In a DAG configuration, however, the backup application might have to specify the active database and log paths, because DAG copy paths are always different from those paths.</span></span>
  
<span data-ttu-id="fb35a-132">Exchange 2013 では、非アクティブな DAG データベースコピーの復元がサポートされていないことに注意してください。</span><span class="sxs-lookup"><span data-stu-id="fb35a-132">Note that Exchange 2013 does not support restoring inactive DAG database copies.</span></span> <span data-ttu-id="fb35a-133">DAG コピーは、アクティブデータベースコピーが復元された場合にのみ、バックアップデータから復元できます。</span><span class="sxs-lookup"><span data-stu-id="fb35a-133">DAG copies can be restored from backup data only when the active database copy is restored.</span></span> <span data-ttu-id="fb35a-134">異なるバックアップデータセットを使用するか、データベースコピーのサブセットを復元しようとすると、データベースが unmountable になることがあります。</span><span class="sxs-lookup"><span data-stu-id="fb35a-134">Using different backup data sets or attempting to restore a subset of the database copies can cause the database to become unmountable.</span></span> <span data-ttu-id="fb35a-135">バックアップアプリケーションは、作成元のデータベースオブジェクトに復元されるため、この場合、 [Setrestoreoptions](https://msdn.microsoft.com/library/windows/desktop/aa382856%28v=vs.85%29.aspx)関数を呼び出す必要はありません。</span><span class="sxs-lookup"><span data-stu-id="fb35a-135">Backup applications do not have to call the [SetRestoreOptions](https://msdn.microsoft.com/library/windows/desktop/aa382856%28v=vs.85%29.aspx) function in this case, because the backups are restored to the original database objects they were created from.</span></span> <span data-ttu-id="fb35a-136">ただし、バックアップアプリケーションが**Setrestoreoptions**を呼び出し、XML メタデータドキュメントに正しいパラメーターがある場合、結果はエラーではありません。</span><span class="sxs-lookup"><span data-stu-id="fb35a-136">However, if the backup application calls **SetRestoreOptions** and the XML metadata document has the correct parameters, the result is not an error.</span></span> 
  
## <a name="restoring-exchange-databases-to-a-recovery-database"></a><span data-ttu-id="fb35a-137">Exchange データベースの回復用データベースへの復元</span><span class="sxs-lookup"><span data-stu-id="fb35a-137">Restoring Exchange databases to a recovery database</span></span>
<span data-ttu-id="fb35a-138"><a name="bk_RecoveryDatabase"> </a></span><span class="sxs-lookup"><span data-stu-id="fb35a-138"><a name="bk_RecoveryDatabase"> </a></span></span>

<span data-ttu-id="fb35a-p109">Exchange ライターを使用すると、回復用のデータベースに直接データを復元できるようになります。回復したデータを回復用データベースとしてマウントすると、Exchange 管理者は個々のメールボックス (メールボックス内の個々のアイテムも) 復元できます。</span><span class="sxs-lookup"><span data-stu-id="fb35a-p109">The Exchange writer enables you to restore data directly to a recovery database. Mounting the recovered data as a recovery database allows the Exchange administrator to restore individual mailboxes, and even individual items in a mailbox.</span></span>
  
<span data-ttu-id="fb35a-141">回復用データベースが既に存在する場合、アプリケーションでデータベースのマウントを解除し、データを回復用データベースとログ ファイルに復元して、データベースを再度マウントできます。</span><span class="sxs-lookup"><span data-stu-id="fb35a-141">If a recovery database already exists, your application can dismount the database, restore the data onto the recovery database and log files, and then remount the database.</span></span>
  
<span data-ttu-id="fb35a-142">各 Exchange 2013 サーバーは、一度に1つの回復用データベースのみをマウントできます。</span><span class="sxs-lookup"><span data-stu-id="fb35a-142">Each Exchange 2013 server allows for only one recovery database to be mounted at a time.</span></span> <span data-ttu-id="fb35a-143">サーバーにはディスク容量に余裕がある限り多くの回復されたデータベースを格納できますが、回復用データベースとしては 1 つのみがマウントできます。</span><span class="sxs-lookup"><span data-stu-id="fb35a-143">The server can contain as many recovered databases as disk space allows, but only one can be mounted as the recovery database.</span></span> <span data-ttu-id="fb35a-144">回復用データベースとしてマウントされたデータベースは、同時にマウントできるデータベースの最大数にカウントされます。</span><span class="sxs-lookup"><span data-stu-id="fb35a-144">The database mounted as the recovery database is counted in the maximum number of databases that can be mounted at a time.</span></span> <span data-ttu-id="fb35a-145">回復用データベースがサーバーの回復用データベースとしてマウントされている場合、どのような方法でも元のメールボックスには関連付けられていません。</span><span class="sxs-lookup"><span data-stu-id="fb35a-145">A recovered database mounted as a server's recovery database is not associated with the original mailbox in any way.</span></span>
  
<span data-ttu-id="fb35a-146">回復用データベースに回復するには、アプリケーションで[Setrestoreoptions](https://msdn.microsoft.com/library/windows/desktop/aa382856%28v=vs.85%29.aspx)メソッドを呼び出し、ソースデータベースとターゲットデータベースの guid を示す XML ドキュメントを指定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="fb35a-146">To recover to a recovery database, your application must call the [SetRestoreOptions](https://msdn.microsoft.com/library/windows/desktop/aa382856%28v=vs.85%29.aspx) method and provide an XML document that indicates the source and target database GUIDs.</span></span> <span data-ttu-id="fb35a-147">ソースの GUID はバックアップ セットの GUID と一致する必要があり、ターゲットの GUID は AD DS の復元先データベースのエントリと一致している必要があります。</span><span class="sxs-lookup"><span data-stu-id="fb35a-147">The source GUIDs must match those from the backup set, and the target GUIDs must match the destination database entries in AD DS.</span></span> <span data-ttu-id="fb35a-148">また、バックアップアプリケーションは、ファイルの復元先のディレクトリパスを指定するために、 [Addnewtarget](https://msdn.microsoft.com/library/windows/desktop/aa382648%28v=vs.85%29.aspx)メソッドを呼び出す必要があります。</span><span class="sxs-lookup"><span data-stu-id="fb35a-148">The backup application must also call the [AddNewTarget](https://msdn.microsoft.com/library/windows/desktop/aa382648%28v=vs.85%29.aspx) method to specify the directory path where the files are restored to.</span></span> <span data-ttu-id="fb35a-149">データベースファイルの名前を変更する必要がある場合、Exchange ライターは[Onpostrestore](https://msdn.microsoft.com/library/windows/desktop/aa381566%28v=vs.85%29.aspx)操作中にデータベースの名前を変更します。</span><span class="sxs-lookup"><span data-stu-id="fb35a-149">If the database files need to be renamed, the Exchange writer will rename the database during the [OnPostRestore](https://msdn.microsoft.com/library/windows/desktop/aa381566%28v=vs.85%29.aspx) operation.</span></span> <span data-ttu-id="fb35a-150">Exchange では、トランザクションログファイルを現在のトランザクションログファイルパスの下にあるサブフォルダー ( **_restoredLogs**) に復元する必要があります。</span><span class="sxs-lookup"><span data-stu-id="fb35a-150">Exchange requires the transaction log files to be restored to a subfolder ( **_restoredLogs**) under the current transaction log file path.</span></span> <span data-ttu-id="fb35a-151">このログ ファイルが別の場所に復元されると、Exchange ライターはエラーを返します。</span><span class="sxs-lookup"><span data-stu-id="fb35a-151">If the log files are restored to any other location, the Exchange writer will return an error.</span></span> <span data-ttu-id="fb35a-152">回復用データベースとしてマウントされるデータベースは元の場所には復元されないため、マウントする前にクリーン シャットダウン状態にする必要があります。</span><span class="sxs-lookup"><span data-stu-id="fb35a-152">Because databases being mounted as the recovery database are not restored to their original location, they need to be brought into clean-shutdown state before they can be mounted.</span></span> <span data-ttu-id="fb35a-153">既定では、Exchange ライターは、復元したすべてのデータベースを復元後の手順でクリーン シャットダウン状態にします。</span><span class="sxs-lookup"><span data-stu-id="fb35a-153">By default, the Exchange writer will bring all the restored databases into a clean-shutdown state during post-restore.</span></span> <span data-ttu-id="fb35a-154">バックアップアプリケーションが[Setadditionalrestores](https://msdn.microsoft.com/library/windows/desktop/aa382829%28v=vs.85%29.aspx)方法を呼び出した場合、Exchange ライターはログファイルを再生しないで、管理者またはバックアップアプリケーションはデータベースをマウントする前に、データベースをクリーンシャットダウン状態にする必要があります。</span><span class="sxs-lookup"><span data-stu-id="fb35a-154">If your backup application calls the [SetAdditionalRestores](https://msdn.microsoft.com/library/windows/desktop/aa382829%28v=vs.85%29.aspx) method, the Exchange writer will not replay the log files, and either the administrator or your backup application needs to bring the database into a clean-shutdown state prior to mounting the database.</span></span> 
  
## <a name="restoring-exchange-databases-to-a-recovery-server"></a><span data-ttu-id="fb35a-155">Exchange データベースの回復用サーバーへの復元</span><span class="sxs-lookup"><span data-stu-id="fb35a-155">Restoring Exchange databases to a recovery server</span></span>
<span data-ttu-id="fb35a-156"><a name="bk_RecoveryServer"> </a></span><span class="sxs-lookup"><span data-stu-id="fb35a-156"><a name="bk_RecoveryServer"> </a></span></span>

<span data-ttu-id="fb35a-157">シナリオによっては、バックアップセットを別のサーバーに復元する必要があります。たとえば、メールボックスデータベースを同じ Exchange 組織内の別の Exchange 2013 サーバーに移行することによって、またはメールボックスとパブリックフォルダーのデータを回復するために、運用環境外の専用サーバーに復元することによって、致命的なサーバー障害から回復する必要がある場合があります。</span><span class="sxs-lookup"><span data-stu-id="fb35a-157">In some scenarios, you might need to recover a backup set to another server; For example, you might need to recover from a catastrophic server failure by porting the mailbox database to another Exchange 2013 server in the same Exchange organization, or restore to a dedicated server outside the production environment to recover mailbox and public folder data.</span></span> 
  
<span data-ttu-id="fb35a-158">このようなシナリオでは、ターゲット データベースのファイル パスとオブジェクト GUID は、どちらも元のものとは異なります。</span><span class="sxs-lookup"><span data-stu-id="fb35a-158">In these scenarios, the file paths for the target database as well as its object GUIDs are different than those for the original database.</span></span> <span data-ttu-id="fb35a-159">そのため、アプリケーションでは、ソースデータベースとターゲットデータベースの情報を示す XML ドキュメントを使用して[Setrestoreoptions](https://msdn.microsoft.com/library/windows/desktop/aa382856%28v=vs.85%29.aspx)メソッドを呼び出し、 [addnewtarget](https://msdn.microsoft.com/library/windows/desktop/aa382648%28v=vs.85%29.aspx)メソッドを呼び出して、バックアップファイルの復元先のディレクトリパスを指定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="fb35a-159">Therefore, your application has to call the [SetRestoreOptions](https://msdn.microsoft.com/library/windows/desktop/aa382856%28v=vs.85%29.aspx) method with an XML document that indicates the source and target database information, and call the [AddNewTarget](https://msdn.microsoft.com/library/windows/desktop/aa382648%28v=vs.85%29.aspx) method to specify the directory paths to restore the backup files to.</span></span> <span data-ttu-id="fb35a-160">Exchange ライターの場合、この復元は、回復用データベースへの復元と同じになります。</span><span class="sxs-lookup"><span data-stu-id="fb35a-160">For the Exchange writer, this restore is the same as restoring to a recovery database.</span></span> <span data-ttu-id="fb35a-161">詳細については、この記事の「 [Exchange データベースの回復用データベースへの復元](restoring-exchange-2013-databases.md#bk_RecoveryDatabase)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="fb35a-161">For more information, see [Restoring Exchange databases to a recovery database](restoring-exchange-2013-databases.md#bk_RecoveryDatabase) earlier in this article.</span></span> 
  
## <a name="see-also"></a><span data-ttu-id="fb35a-162">関連項目</span><span class="sxs-lookup"><span data-stu-id="fb35a-162">See also</span></span>
<span data-ttu-id="fb35a-163"><a name="bk_AdditionalResources"> </a></span><span class="sxs-lookup"><span data-stu-id="fb35a-163"><a name="bk_AdditionalResources"> </a></span></span>

- [<span data-ttu-id="fb35a-164">Exchange 2013 のバックアップ操作の種類</span><span class="sxs-lookup"><span data-stu-id="fb35a-164">Types of backup operations for Exchange 2013</span></span>](types-of-backup-operations-for-exchange-2013.md)
    
- [<span data-ttu-id="fb35a-165">Exchange 2013 のバックアップと復元アプリケーションの作成</span><span class="sxs-lookup"><span data-stu-id="fb35a-165">Build backup and restore applications for Exchange 2013</span></span>](build-backup-and-restore-applications-for-exchange-2013.md)
    
- [<span data-ttu-id="fb35a-166">Exchange 2013 のバックアップと復元の概念</span><span class="sxs-lookup"><span data-stu-id="fb35a-166">Backup and restore concepts for Exchange 2013</span></span>](backup-and-restore-concepts-for-exchange-2013.md)
    
- [<span data-ttu-id="fb35a-167">CChkSGFiles クラスの参照</span><span class="sxs-lookup"><span data-stu-id="fb35a-167">CChkSGFiles class reference</span></span>](cchksgfiles-class-reference.md)
    

