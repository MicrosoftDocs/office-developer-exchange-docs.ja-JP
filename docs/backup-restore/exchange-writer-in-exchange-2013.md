---
title: Exchange 2013 の Exchange ライター
manager: sethgros
ms.date: 09/17/2015
ms.audience: Developer
ms.topic: overview
ms.prod: office-online-server
localization_priority: Normal
ms.assetid: ec126433-9f0a-46ec-a685-ff4af2f97bc1
description: Exchange 2013 のバックアップを Exchange ライターに関する情報を検索し、操作を復元します。
ms.openlocfilehash: a4dc5963ab24a83969efc6e425b38a35276f3aa3
ms.sourcegitcommit: 34041125dc8c5f993b21cebfc4f8b72f0fd2cb6f
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 06/11/2018
ms.locfileid: "19758858"
---
# <a name="exchange-writer-in-exchange-2013"></a><span data-ttu-id="d29b5-103">Exchange 2013 の Exchange ライター</span><span class="sxs-lookup"><span data-stu-id="d29b5-103">Exchange writer in Exchange 2013</span></span>

<span data-ttu-id="d29b5-104">Exchange 2013 のバックアップを Exchange ライターに関する情報を検索し、操作を復元します。</span><span class="sxs-lookup"><span data-stu-id="d29b5-104">Find information about the Exchange writer in Exchange 2013 for backup and restore operations.</span></span> 
  
<span data-ttu-id="d29b5-105">**に適用されます:** Exchange Server 2013</span><span class="sxs-lookup"><span data-stu-id="d29b5-105">**Applies to:** Exchange Server 2013</span></span> 
  
<span data-ttu-id="d29b5-106">Exchange 書き込みプログラムは、バックアップと Exchange Server 2013 のアクティブなデータベースの復元を担当します。</span><span class="sxs-lookup"><span data-stu-id="d29b5-106">The Exchange writer is responsible for the backup and restore of active Exchange Server 2013 databases.</span></span> <span data-ttu-id="d29b5-107">Exchange 書き込みプログラムには、シャドウ ・ コピーを取るようデータベースとトランザクションのレプリケートされたインスタンスに対してログ ファイルの選択したデータベースのバックアップ機能もサポートしています。</span><span class="sxs-lookup"><span data-stu-id="d29b5-107">The Exchange writer also supports backup functionality for a selected database where the shadow copy is taken against the replicated instance of the database and transaction log files.</span></span> 
  
## <a name="overview-of-the-exchange-writer"></a><span data-ttu-id="d29b5-108">Exchange ライターの概要</span><span class="sxs-lookup"><span data-stu-id="d29b5-108">Overview of the Exchange writer</span></span>
<span data-ttu-id="d29b5-109"><a name="bk_Overview"> </a></span><span class="sxs-lookup"><span data-stu-id="d29b5-109"></span></span>

<span data-ttu-id="d29b5-110">Exchange 2013 には、データベースの可用性とサイトの回復性を向上させるために別の Exchange サーバー間でレプリケートするデータベースを有効にするデータベースの移動の機能が含まれています。</span><span class="sxs-lookup"><span data-stu-id="d29b5-110">Exchange 2013 includes database mobility features, which enable databases to be replicated among different Exchange servers to improve database availability and site resilience.</span></span> <span data-ttu-id="d29b5-111">他のデータベース コピー、データベース可用性グループ (DAG) では、Exchange のバックアップ コピーの場所で使用できる追加のリソースを使用するための貴重な機会を提供します。</span><span class="sxs-lookup"><span data-stu-id="d29b5-111">The other database copies in a Database Availability Group (DAG) provide a valuable opportunity for Exchange backups to use the extra resources that are available at the copy location.</span></span> <span data-ttu-id="d29b5-112">さらに、アクティブなデータベースのマスターではなくコピーがバックアップされるため、コピーできます利用可能なバックアップ中に時間の長い期間。</span><span class="sxs-lookup"><span data-stu-id="d29b5-112">In addition, because the copy instead of the active database master is backed up, the copy can be unavailable during the backup for a longer period of time.</span></span> 
  
<span data-ttu-id="d29b5-113">Exchange ライターは Exchange サービス (リクエスターのために動作) と連携して、バックアップに備えてデータベース ファイルを準備し、データベースをバックアップする前に Exchange トランザクションの結果として生じる IO アクティビティを固定します。その後、バックアップが完了してから、ログ ファイルの固定を解除して切り詰めます。</span><span class="sxs-lookup"><span data-stu-id="d29b5-113">The Exchange writer coordinates with the Exchange services (operating on behalf of the requester) to prepare the database files for backups, freeze the IO activity resulting from Exchange transactions before backing up the database, and then unfreeze and truncate log files after the backup is complete.</span></span>
  
<span data-ttu-id="d29b5-p103">復元中、バックアップと復元アプリケーションは、(リクエスターのために動作する) Exchange ストアと連携して、復元ターゲットの検証、データベース ファイルの名前変更 (必要な場合)、必要に応じてトランザクション ログの再生を行うよう Exchange ライターに指示します。Exchange ライターは、バックアップと復元の両方をサポートします。</span><span class="sxs-lookup"><span data-stu-id="d29b5-p103">During a restore, your backup and restore application instructs the Exchange writer to coordinate with the Exchange store (operating on behalf of the requester) to verify the restore targets, rename the database file if necessary, and then replay the transaction logs as needed. The Exchange writer supports both backups and restores.</span></span>
  
<span data-ttu-id="d29b5-116">Exchange ライターは、メールボックス サーバーの役割がインストールされている Exchange サーバーで利用できます。 </span><span class="sxs-lookup"><span data-stu-id="d29b5-116">The Exchange writer is available on any Exchange server that has the Mailbox server role installed.</span></span> 
  
## <a name="exchange-writer-configuration-settings"></a><span data-ttu-id="d29b5-117">Exchange ライターの構成設定 </span><span class="sxs-lookup"><span data-stu-id="d29b5-117">Exchange writer configuration settings</span></span>
<span data-ttu-id="d29b5-118"><a name="bk_ExchangeWriterConfig"> </a></span><span class="sxs-lookup"><span data-stu-id="d29b5-118"></span></span>

<span data-ttu-id="d29b5-p104">VSS 用の Exchange ライターは、正しく設定され、バックアップと復元の操作中に保持されることが必要な各種設定と値を使います。これらの構成設定は、Exchange ライターのメタデータ ドキュメントに格納されます。バックアップ アプリケーションがこれらの設定を保持しない場合、Exchange データベースのバックアップを試みると予期しないエラーが発生する可能性があります。 </span><span class="sxs-lookup"><span data-stu-id="d29b5-p104">The Exchange writer for VSS uses a variety of settings and values that must be set correctly and preserved during backup and restore operations. These configuration settings are stored in the Exchange writer metadata document. If your backup application does not preserve these settings, you might experience unexpected errors when you attempt to back up your Exchange databases.</span></span> 
  
<span data-ttu-id="d29b5-p105">以下の表は、データベース バックアップのコンポーネントに関するメタデータを公開する VSS インタ フェースを一覧表示します。これらのインターフェイスは、Exchange ストアのバックアップに使う Exchange ライター メタデータ ドキュメントを取得するときに必要です。</span><span class="sxs-lookup"><span data-stu-id="d29b5-p105">The following table lists the VSS interfaces that expose metadata about the components of your database backup. These interfaces are required to get the Exchange writer metadata document that is used to perform a backup of the Exchange store.</span></span>
  
<span data-ttu-id="d29b5-124">**表 1 です。VSS インタ フェース**</span><span class="sxs-lookup"><span data-stu-id="d29b5-124">**Table 1. VSS interfaces**</span></span>

|<span data-ttu-id="d29b5-125">**VSS インタ フェース**</span><span class="sxs-lookup"><span data-stu-id="d29b5-125">**VSS interface**</span></span>|<span data-ttu-id="d29b5-126">**説明**</span><span class="sxs-lookup"><span data-stu-id="d29b5-126">**Description**</span></span>|
|:-----|:-----|
|<span data-ttu-id="d29b5-127">IVssWMComponent</span><span class="sxs-lookup"><span data-stu-id="d29b5-127">IVssWMComponent</span></span>  <br/> |<span data-ttu-id="d29b5-128">Exchange ライターに格納されているコンポーネント情報にアクセスできるようにします。</span><span class="sxs-lookup"><span data-stu-id="d29b5-128">Allows access to component information stored in the Exchange writer.</span></span>  <br/> |
|<span data-ttu-id="d29b5-129">IVssExamineWriterMetadata</span><span class="sxs-lookup"><span data-stu-id="d29b5-129">IVssExamineWriterMetadata</span></span>  <br/> |<span data-ttu-id="d29b5-130">Exchange ライターのメタデータを調べるには、要求元のバックアップと復元の次のアプリケーションを使用できます。</span><span class="sxs-lookup"><span data-stu-id="d29b5-130">Allows the requesting backup and restore application to examine the metadata of the Exchange writer.</span></span> <span data-ttu-id="d29b5-131">Exchange ライターのメタデータ ドキュメントには、Exchange 2013 に固有の値およびバックアップのための適切なコンポーネントを正しく指定することができるように、要求元のバックアップおよび復元アプリケーションが必要なパラメーターが含まれています。</span><span class="sxs-lookup"><span data-stu-id="d29b5-131">The Exchange writer metadata document contains Exchange 2013-specific values and parameters that the requesting backup and restore application requires so that it can correctly specify the appropriate components for backup.</span></span>  <br/> |
|<span data-ttu-id="d29b5-132">IVssComponent</span><span class="sxs-lookup"><span data-stu-id="d29b5-132">IVssComponent</span></span>  <br/> |<span data-ttu-id="d29b5-133">調べると、依頼者のバックアップ コンポーネント ドキュメントに含まれるコンポーネントについての情報を変更するためのメソッドが含まれています。</span><span class="sxs-lookup"><span data-stu-id="d29b5-133">Contains methods for examining and modifying information about components contained in a requester's Backup Components Document.</span></span> <span data-ttu-id="d29b5-134">オブジェクトは、この文書に、 [IVssBackupComponents::AddComponent](http://msdn.microsoft.com/en-us/library/windows/desktop/aa382646%28v=vs.85%29.aspx)メソッドによって明示的に追加されているコンポーネントにのみ取得できます。</span><span class="sxs-lookup"><span data-stu-id="d29b5-134">Objects can only be obtained for those components that have been explicitly added to this document by the [IVssBackupComponents::AddComponent](http://msdn.microsoft.com/en-us/library/windows/desktop/aa382646%28v=vs.85%29.aspx) method.</span></span>  <br/> |
|<span data-ttu-id="d29b5-135">IVssBackupComponents</span><span class="sxs-lookup"><span data-stu-id="d29b5-135">IVssBackupComponents</span></span>  <br/> |<span data-ttu-id="d29b5-136">ファイルのステータスに関する Exchange ライターをポーリングし、バックアップ操作と復元操作は、要求元のバックアップと復元のアプリケーションによって使用されます。</span><span class="sxs-lookup"><span data-stu-id="d29b5-136">Used by the requesting backup and restore application to poll the Exchange writer about file status and to run backup and restore operations.</span></span> <span data-ttu-id="d29b5-137">[IVssBackupComponents::SetBackupState](http://msdn.microsoft.com/en-us/library/windows/desktop/aa382833%28v=vs.85%29.aspx)メソッドでは、バックアップ操作は、かどうか、フル ・ コピー、増分、または差分バックアップを定義します。</span><span class="sxs-lookup"><span data-stu-id="d29b5-137">The [IVssBackupComponents::SetBackupState ](http://msdn.microsoft.com/en-us/library/windows/desktop/aa382833%28v=vs.85%29.aspx) method defines whether the backup operation is a full, copy, incremental, or differential backup.</span></span> <span data-ttu-id="d29b5-138">[IVssBackupComponents::AddRestoreSubcomponent](http://msdn.microsoft.com/en-us/library/windows/desktop/aa382649%28v=vs.85%29.aspx)メソッドでは、Exchange 2013 のデータベース復元操作のために選択できるのサブコンポーネントを定義します。</span><span class="sxs-lookup"><span data-stu-id="d29b5-138">The [IVssBackupComponents::AddRestoreSubcomponent](http://msdn.microsoft.com/en-us/library/windows/desktop/aa382649%28v=vs.85%29.aspx) method defines the subcomponents of an Exchange 2013 database that can be selected for a restore operation.</span></span>  <br/> |
   
<span data-ttu-id="d29b5-139">*拡張子を持つ 1 つのデータベース ファイルと、Windows サーバーのファイル システム内で、Exchange 2013 のデータベースが格納されている .edb ファイルです。Exchange 書き込みプログラムを公開、*トランザクション ・ ログの中に、データベース コンポーネントと、.edb ファイル (*.log) およびチェックポイント ファイル (*.chk) ログ コンポーネントと呼ばれる、1 つのコンポーネントに結合されます。</span><span class="sxs-lookup"><span data-stu-id="d29b5-139">Within the Windows Server file system, an Exchange 2013 database is stored as a single database file with an extension *.edb. The Exchange writer exposes the *.edb as the database component, while transaction logs (*.log) and checkpoint files (*.chk) are combined into a single component, referred to as the log component.</span></span> <span data-ttu-id="d29b5-140">Exchange データベース ファイルの詳細については、 [Exchange 2013 のバックアップと復元の概念](backup-and-restore-concepts-for-exchange-2013.md)を参照してください。</span><span class="sxs-lookup"><span data-stu-id="d29b5-140">For more information about Exchange database files, see [Backup and restore concepts for Exchange 2013](backup-and-restore-concepts-for-exchange-2013.md).</span></span>
  
## <a name="interactions-between-the-exchange-writer-vss-and-vss-requesters"></a><span data-ttu-id="d29b5-141">Exchange ライター、VSS、VSS リクエスター間の相互作用</span><span class="sxs-lookup"><span data-stu-id="d29b5-141">Interactions between the Exchange writer, VSS, and VSS requesters</span></span>
<span data-ttu-id="d29b5-142"><a name="bk_interactions"> </a></span><span class="sxs-lookup"><span data-stu-id="d29b5-142"></span></span>

<span data-ttu-id="d29b5-143">VSS では、Exchange ライターの間で高度な相互作用し、バックアップ処理中に Exchange 2013 は、次のようにします。</span><span class="sxs-lookup"><span data-stu-id="d29b5-143">The high-level interaction between the VSS, the Exchange writer, and Exchange 2013 during backup operations is as follows:</span></span>
  
1. <span data-ttu-id="d29b5-144">バックアップ プログラム (またはエージェント) がスケジュールされたジョブを実行します。</span><span class="sxs-lookup"><span data-stu-id="d29b5-144">The backup program (or agent) runs a scheduled job.</span></span> 
    
2. <span data-ttu-id="d29b5-145">バックアップと復元アプリケーションの VSS リクエスターでは、選択した Exchange 2013 データベースのシャドウ ・ コピーに VSS にコマンドを送ります。</span><span class="sxs-lookup"><span data-stu-id="d29b5-145">The VSS requester in the backup and restore application sends a command to VSS to take a shadow copy of the selected Exchange 2013 databases.</span></span> 
    
3. <span data-ttu-id="d29b5-146">VSS は、スナップショット ・ バックアップ用に準備する Exchange 書き込みプログラムと通信します。</span><span class="sxs-lookup"><span data-stu-id="d29b5-146">VSS communicates with the Exchange writer to prepare for a snapshot backup.</span></span> <span data-ttu-id="d29b5-147">Exchange 2013 は、データベースに対する管理操作は禁止されています、ボリュームの依存関係をチェックし、読み取り専用アクセスを可能にしながら、データベースとトランザクション ログ ファイルの選択したインスタンスへのすべての書き込み操作を中断します。</span><span class="sxs-lookup"><span data-stu-id="d29b5-147">Exchange 2013 prohibits administrative actions against the databases, checks volume dependencies, and suspends all write operations to selected instance of the database and transaction log files while allowing read-only access.</span></span> 
    
4. <span data-ttu-id="d29b5-148">VSS は、Exchange 2013 のデータベースを含むストレージ ボリュームのシャドウ コピーを作成するのには適切なストレージ プロバイダーと通信します。</span><span class="sxs-lookup"><span data-stu-id="d29b5-148">VSS communicates with the appropriate storage provider to create a shadow copy of the storage volume that contains the Exchange 2013 databases.</span></span> 
    
5. <span data-ttu-id="d29b5-149">VSS では、通常の処理を再開するのには、Exchange 2013 を解放します。</span><span class="sxs-lookup"><span data-stu-id="d29b5-149">VSS releases Exchange 2013 to resume ordinary operations.</span></span> 
    
6. <span data-ttu-id="d29b5-150">VSS リクエスターは、バックアップが正常に完了したことを通知する前に設定のバックアップの物理的な整合性を検証します。</span><span class="sxs-lookup"><span data-stu-id="d29b5-150">The VSS requester verifies the physical consistency of the backup set prior to signaling that the backup was successful.</span></span> <span data-ttu-id="d29b5-151">Exchange 2013 は、トランザクション ・ ログをトランケート (データベースが DAG の一部である場合は、ログの切り捨てはレプリケートされたすべてのコピーの間で) し、データベースの最後のバックアップの時間を記録します。</span><span class="sxs-lookup"><span data-stu-id="d29b5-151">Exchange 2013 truncates the transaction logs (if the database is part of a DAG, log truncation is replicated among all the copies) and records the time of the last backup for the database.</span></span>
    
<span data-ttu-id="d29b5-152">VSS は、 [OnPostSnapshot](http://msdn.microsoft.com/en-us/library/windows/desktop/aa381568%28v=vs.85%29.aspx)メソッドで[OnPrepareBackup](http://msdn.microsoft.com/en-us/library/windows/desktop/aa381571%28v=vs.85%29.aspx)メソッドを使用して開始および終了は、Exchange ライターに依頼者の操作をシリアル化します。</span><span class="sxs-lookup"><span data-stu-id="d29b5-152">VSS serializes requesters' interaction with the Exchange writer starting with the [OnPrepareBackup](http://msdn.microsoft.com/en-us/library/windows/desktop/aa381571%28v=vs.85%29.aspx) method and ending with the [OnPostSnapshot](http://msdn.microsoft.com/en-us/library/windows/desktop/aa381568%28v=vs.85%29.aspx) method.</span></span> <span data-ttu-id="d29b5-153">通常、シャドウ コピーの整合性がバックアップの完了前に確認すると Exchange writer がシャドウ コピーでの作業に費やす時間の大半に、 **OnPostSnapshot**メソッドでは後に、発生します。</span><span class="sxs-lookup"><span data-stu-id="d29b5-153">Typically, the majority of time the Exchange writer spends working with the shadow copy occurs after the **OnPostSnapshot** method, when the consistency of the shadow copy is verified prior to completion of the backups.</span></span> <span data-ttu-id="d29b5-154">Exchange 書き込みプログラムは、 **OnPostSnapshot**と[OnBackupComplete](http://msdn.microsoft.com/en-us/library/windows/desktop/aa381557%28v=vs.85%29.aspx)の並列バックアップをサポートしています。</span><span class="sxs-lookup"><span data-stu-id="d29b5-154">The Exchange writer supports parallel backups between **OnPostSnapshot** and [OnBackupComplete](http://msdn.microsoft.com/en-us/library/windows/desktop/aa381557%28v=vs.85%29.aspx).</span></span>
  
<span data-ttu-id="d29b5-155">Exchange 2013 では、同じデータベースのバックアップを同時実行が許可されていません。</span><span class="sxs-lookup"><span data-stu-id="d29b5-155">Exchange 2013 does not allow concurrent backups of the same database.</span></span> <span data-ttu-id="d29b5-156">バックアップ ジョブを 1 つだけが一度に 1 つの特定のデータベースに対して実行できます。</span><span class="sxs-lookup"><span data-stu-id="d29b5-156">Only one backup job can run against a given database at one time.</span></span> <span data-ttu-id="d29b5-157">バックアップの実行中、Exchange ストアは、バックアップの進行中の状態にデータベースを配置します。</span><span class="sxs-lookup"><span data-stu-id="d29b5-157">When the backup is running, the Exchange store puts the database in a backup-in-progress state.</span></span> <span data-ttu-id="d29b5-158">いずれかのバックアップ ・ プロセス、またはサービスを再起動すると完了した時点で、このメモリの状態がクリアされます。</span><span class="sxs-lookup"><span data-stu-id="d29b5-158">This in-memory state is cleared either at the completion of the backup process or when the service is restarted.</span></span> <span data-ttu-id="d29b5-159">オペレーティング システムを再起動すると、Exchange ライターをホストするサービスを再起動するとき、またはクラスターのフェイル オーバーが発生した場合、メモリ内の進行中のバックアップの状態とその関連データは失われます。</span><span class="sxs-lookup"><span data-stu-id="d29b5-159">The in-memory backup-in-progress state and its associated data are lost when the service that hosts the Exchange writer is restarted, when the operating system is restarted, or when a cluster failover occurs.</span></span> <span data-ttu-id="d29b5-160">バックアップ ジョブが失敗するが、これらのイベントが発生します。</span><span class="sxs-lookup"><span data-stu-id="d29b5-160">Any of these events will cause the backup job to fail.</span></span>
  
<span data-ttu-id="d29b5-p114">実行するバックアップの種類に基づいて、バックアップ開始トランザクション ログ ファイルの切り詰めがトリガーされます。DAG 以外の構成では、Exchange ライターは、完全バックアップや増分バックアップが正常に完了したときにトランザクション ログ ファイルを切り詰めます。DAG のレプリケートされた構成では、すべての必要なログ ファイルが他のすべてのコピーに再生されるまで、レプリケーション サービスによってログの切り詰めが遅延されます。レプリケーション サービスは、アクティブなログ ファイル パスとコピー ログ ファイル パスの両方からバックアップ ログ ファイルを削除します。この削除は、ログ ファイルがコピー データベースに正常に適用され、アクティブ データベースとデータベース コピー チェックポイントの両方が削除対象のログ ファイルを渡したことを確認した後に行われます。</span><span class="sxs-lookup"><span data-stu-id="d29b5-p114">Backup-initiated transaction log file truncation is triggered based on the type of backup to be performed. In non-DAG configurations, the Exchange writer will truncate the transaction log files at the completion of successful full or incremental backups. In DAG replicated configurations, log truncation will be delayed by the replication service until all necessary log files are replayed into all other copies. The replication service will delete the backed up log files both from the active and the copy log file paths after it verifies that the log files have successfully been applied to the copy database and both active database and the database copies checkpoint has passed the log files to be deleted.</span></span>
  
## <a name="see-also"></a><span data-ttu-id="d29b5-165">関連項目</span><span class="sxs-lookup"><span data-stu-id="d29b5-165">See also</span></span>

- [<span data-ttu-id="d29b5-166">トランザクション ログとチェックポイント ファイルをバックアップおよび復元では、Exchange 2013 の</span><span class="sxs-lookup"><span data-stu-id="d29b5-166">Transaction logs and checkpoint files for backup and restore in Exchange 2013</span></span>](transaction-logs-and-checkpoint-files-for-backup-and-restore-in-exchange.md)
    
- [<span data-ttu-id="d29b5-167">Exchange 2013 のバックアップと復元の概念</span><span class="sxs-lookup"><span data-stu-id="d29b5-167">Backup and restore concepts for Exchange 2013</span></span>](backup-and-restore-concepts-for-exchange-2013.md)
    

